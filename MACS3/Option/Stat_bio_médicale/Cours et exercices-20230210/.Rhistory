event=pharmacoSmoking$ttr
delta=pharmacoSmoking$relapse
group=pharmacoSmoking$grp
seuil=0.05
test.log.rank(t_,time,event,delta,group,seuil)
t_=40
time=pharmacoSmoking$ttr
event=pharmacoSmoking$ttr
delta=pharmacoSmoking$relapse
group=pharmacoSmoking$grp
seuil=0.05
test.log.rank(t_,time,event,delta,group,seuil)
test.log.rank<-function(t_,time,event,delta,group,seuil){
tmin=min(time)
tmax=max(time)
g1=unique(group)[1]
g2=unique(group)[2]
event
temps=tmin:t_
sum_Vk=0
sumd1k=0
for (t in temps){
c_k=sum(event==t & delta==0)
dk=sum(delta[event==t])
Yk=sum(event>=t)
d1k=sum(delta[event==t & group==g1])
Y1k=sum((event[group == g1])>=t)
d2k=dk-d1k
Y2k=Yk-Y1k
Ek=Y1k*dk/Yk
Vk=((Yk-dk)/Yk-1)*(dk*Y1k*Y2k/(Yk^2))
sum_Vk=sum_Vk+Vk
sumd1k=sumd1k+(d1k-Ek)
}
test=(sumd1k**2)/sum_Vk
cat("ma statistique de test vaut :\n")
cat(test,"\n")
ptest=1-pchisq(test,1)
if(ptest>seuil){
cat("L'hypothèse H0 : S1(t)=S2(t) est accépté au seuil donné \n")
}else{
cat("L'hypothèse H0 : S1(t)=S2(t) est rejeté au seuil donné \n")
}
return(test)
}
t_=40
time=pharmacoSmoking$ttr
event=pharmacoSmoking$ttr
delta=pharmacoSmoking$relapse
group=pharmacoSmoking$grp
seuil=0.05
test.log.rank(t_,time,event,delta,group,seuil)
test.log.rank<-function(t_,time,event,delta,group,seuil){
tmin=min(time)
tmax=max(time)
g1=unique(group)[1]
g2=unique(group)[2]
event
temps=tmin:t_
sum_Vk=0
sumd1k=0
for (t in temps){
c_k=sum(event==t & delta==0)
dk=sum(delta[event==t])
Yk=sum(event>=t)
d1k=sum(delta[event==t & group==g1])
Y1k=sum((event[group == g1])>=t)
d2k=dk-d1k
Y2k=Yk-Y1k
Ek=Y1k*dk/Yk
Vk=((Yk-dk)/(Yk-1))*(dk*Y1k*Y2k/(Yk^2))
sum_Vk=sum_Vk+Vk
sumd1k=sumd1k+(d1k-Ek)
}
test=(sumd1k^2)/sum_Vk
cat("ma statistique de test vaut :\n")
cat(test,"\n")
ptest=1-pchisq(test,1)
if(ptest>seuil){
cat("L'hypothèse H0 : S1(t)=S2(t) est accépté au seuil donné \n")
}else{
cat("L'hypothèse H0 : S1(t)=S2(t) est rejeté au seuil donné \n")
}
return(test)
}
t_=40
time=pharmacoSmoking$ttr
event=pharmacoSmoking$ttr
delta=pharmacoSmoking$relapse
group=pharmacoSmoking$grp
seuil=0.05
test.log.rank(t_,time,event,delta,group,seuil)
t_=20
time=pharmacoSmoking$ttr
event=pharmacoSmoking$ttr
delta=pharmacoSmoking$relapse
group=pharmacoSmoking$grp
seuil=0.05
test.log.rank(t_,time,event,delta,group,seuil)
t_=10
time=pharmacoSmoking$ttr
event=pharmacoSmoking$ttr
delta=pharmacoSmoking$relapse
group=pharmacoSmoking$grp
seuil=0.05
test.log.rank(t_,time,event,delta,group,seuil)
test.log.rank<-function(time,event,delta,group,seuil){
tmin=min(time)
tmax=max(time)
g1=unique(group)[1]
g2=unique(group)[2]
event
temps=tmin:tmax
sum_Vk=0
sumd1k=0
for (t in temps){
c_k=sum(event==t & delta==0)
dk=sum(delta[event==t])
Yk=sum(event>=t)
d1k=sum(delta[event==t & group==g1])
Y1k=sum((event[group == g1])>=t)
d2k=dk-d1k
Y2k=Yk-Y1k
Ek=Y1k*dk/Yk
Vk=((Yk-dk)/(Yk-1))*(dk*Y1k*Y2k/(Yk^2))
sum_Vk=sum_Vk+Vk
sumd1k=sumd1k+(d1k-Ek)
}
test=(sumd1k^2)/sum_Vk
cat("ma statistique de test vaut :\n")
cat(test,"\n")
ptest=1-pchisq(test,1)
if(ptest>seuil){
cat("L'hypothèse H0 : S1(t)=S2(t) est accépté au seuil donné \n")
}else{
cat("L'hypothèse H0 : S1(t)=S2(t) est rejeté au seuil donné \n")
}
return(test)
}
time=pharmacoSmoking$ttr
event=pharmacoSmoking$ttr
delta=pharmacoSmoking$relapse
group=pharmacoSmoking$grp
seuil=0.05
test.log.rank(time,event,delta,group,seuil)
survdiff(Surv(ttr, relapse) ~ grp, data = pharmacoSmoking,strata=TRUE)
survdiff(Surv(ttr, relapse) ~ grp+strata(employment), data = pharmacoSmoking)
survdiff(Surv(ttr, relapse) ~ grp + strata(employment), data = pharmacoSmoking)
autoplot(survfit(Surv(ttr, relapse) ~ grp, data = pharmacoSmoking))
survfit(Surv(ttr, relapse) ~ grp, data = pharmacoSmoking)
survdiff(Surv(ttr, relapse) ~ grp, data = pharmacoSmoking)
survdiff(Surv(ttr, relapse) ~ grp + strata(employment), data = pharmacoSmoking)
survdiff(Surv(ttr, relapse) ~ grp + strata(employment,gender), data = pharmacoSmoking)
survdiff(Surv(ttr, relapse) ~ grp + strata(employment,gender,levelSmoking), data = pharmacoSmoking)
survdiff(Surv(ttr, relapse) ~ grp + strata(employment,gender,levelSmoking,grp), data = pharmacoSmoking)
survdiff(Surv(ttr, relapse) ~ grp + strata(employment,gender,levelSmoking,ageGroup2), data = pharmacoSmoking)
?strata
model<-coxph(Surv(t,delta) ~. , data = datum1)
summary(model)
set.seed(2)
n=500
x1=rbinom(n,1,0.4)
x2=rbinom(n,1,0.2)
censure=floor(rexp(n,1/2000))
delta=rep(0,n)
t=rep(0,n)
p=0.001
beta=2
#Les jours sont décomptés un à un  par la boucle while et la variable cpt
#chacun étant soumis à un risque instantané.
for(i in 1:n){
test=0
cpt=0
while(test!=1){
cpt=cpt+1
test=rbinom(1,1,p*exp(beta*x1[i]/log(cpt+1)))
if(test==1){t[i]=cpt;delta[i]=1}
if(cpt>censure[i] || cpt==365){t[i]=cpt ; test=1}
}
}
datum1=data.frame(x1=x1,x2=x2,delta=delta,t=t)
set.seed(2)
n=500
x1=rbinom(n,1,0.4)
x2=rbinom(n,1,0.2)
censure=floor(rexp(n,1/2000))
delta=rep(0,n)
t=rep(0,n)
p=0.001
beta=2
#Les jours sont décomptés un à un  par la boucle while et la variable cpt
#chacun étant soumis à un risque instantané.
for(i in 1:n){
test=0
cpt=0
while(test!=1){
cpt=cpt+1
test=rbinom(1,1,p*exp(beta*x1[i]+0.0001*cpt))
if(test==1){t[i]=cpt;delta[i]=1}
if(cpt>censure[i] || cpt==365){t[i]=cpt ; test=1}
}
}
datum2=data.frame(x1=x1,x2=x2,delta=delta,t=t)
model<-coxph(Surv(t,delta) ~. , data = datum1)
summary(model)
?coxph
model<-coxph(Surv(t,delta) ~. , data = datum1)
summary(model)
set.seed(2)
n=500
x1=rbinom(n,1,0.4)
x2=rbinom(n,1,0.2)
censure=floor(rexp(n,1/2000))
delta=rep(0,n)
t=rep(0,n)
p=0.001
beta=2
#Les jours sont décomptés un à un  par la boucle while et la variable cpt
#chacun étant soumis à un risque instantané.
for(i in 1:n){
test=0
cpt=0
while(test!=1){
cpt=cpt+1
test=rbinom(1,1,p*exp(beta*x1[i]/log(cpt+1)))
if(test==1){t[i]=cpt;delta[i]=1}
if(cpt>censure[i] || cpt==365){t[i]=cpt ; test=1}
}
}
datum1=data.frame(x1=x1,x2=x2,delta=delta,t=t)
set.seed(2)
n=500
x1=rbinom(n,1,0.4)
x2=rbinom(n,1,0.2)
censure=floor(rexp(n,1/2000))
delta=rep(0,n)
t=rep(0,n)
p=0.001
beta=2
#Les jours sont décomptés un à un  par la boucle while et la variable cpt
#chacun étant soumis à un risque instantané.
for(i in 1:n){
test=0
cpt=0
while(test!=1){
cpt=cpt+1
test=rbinom(1,1,p*exp(beta*x1[i]+0.0001*cpt))
if(test==1){t[i]=cpt;delta[i]=1}
if(cpt>censure[i] || cpt==365){t[i]=cpt ; test=1}
}
}
datum2=data.frame(x1=x1,x2=x2,delta=delta,t=t)
model<-coxph(Surv(t,delta) ~. , data = datum1)
summary(model)
library(survival)
library(asaur)
#library(tidyverse)
library(ggfortify)
#glimpse(pharmacoSmoking)
test.log.rank<-function(time,event,delta,group,seuil){
tmin=min(time)
tmax=max(time)
g1=unique(group)[1]
g2=unique(group)[2]
event
temps=tmin:tmax
sum_Vk=0
sumd1k=0
for (t in temps){
c_k=sum(event==t & delta==0)
dk=sum(delta[event==t])
Yk=sum(event>=t)
d1k=sum(delta[event==t & group==g1])
Y1k=sum((event[group == g1])>=t)
d2k=dk-d1k
Y2k=Yk-Y1k
Ek=Y1k*dk/Yk
Vk=((Yk-dk)/(Yk-1))*(dk*Y1k*Y2k/(Yk^2))
sum_Vk=sum_Vk+Vk
sumd1k=sumd1k+(d1k-Ek)
}
test=(sumd1k^2)/sum_Vk
cat("ma statistique de test vaut :\n")
cat(test,"\n")
ptest=1-pchisq(test,1)
if(ptest>seuil){
cat("L'hypothèse H0 : S1(t)=S2(t) est accépté au seuil donné \n")
}else{
cat("L'hypothèse H0 : S1(t)=S2(t) est rejeté au seuil donné \n")
}
return(test)
}
time=pharmacoSmoking$ttr
event=pharmacoSmoking$ttr
delta=pharmacoSmoking$relapse
group=pharmacoSmoking$grp
seuil=0.05
test.log.rank(time,event,delta,group,seuil)
survdiff(Surv(ttr, relapse) ~ grp, data = pharmacoSmoking)
autoplot(survfit(Surv(ttr, relapse) ~ grp, data = pharmacoSmoking))
unique(pharmacoSmoking$ttr[order(pharmacoSmoking$ttr)])
survdiff(Surv(ttr, relapse) ~ grp, data = pharmacoSmoking)
survdiff(Surv(ttr, relapse) ~ grp + strata(employment,gender,levelSmoking,ageGroup2), data = pharmacoSmoking)
set.seed(2)
n=500
x1=rbinom(n,1,0.4)
x2=rbinom(n,1,0.2)
censure=floor(rexp(n,1/2000))
delta=rep(0,n)
t=rep(0,n)
p=0.001
beta=2
#Les jours sont décomptés un à un  par la boucle while et la variable cpt
#chacun étant soumis à un risque instantané.
for(i in 1:n){
test=0
cpt=0
while(test!=1){
cpt=cpt+1
test=rbinom(1,1,p*exp(beta*x1[i]/log(cpt+1)))
if(test==1){t[i]=cpt;delta[i]=1}
if(cpt>censure[i] || cpt==365){t[i]=cpt ; test=1}
}
}
datum1=data.frame(x1=x1,x2=x2,delta=delta,t=t)
set.seed(2)
n=500
x1=rbinom(n,1,0.4)
x2=rbinom(n,1,0.2)
censure=floor(rexp(n,1/2000))
delta=rep(0,n)
t=rep(0,n)
p=0.001
beta=2
#Les jours sont décomptés un à un  par la boucle while et la variable cpt
#chacun étant soumis à un risque instantané.
for(i in 1:n){
test=0
cpt=0
while(test!=1){
cpt=cpt+1
test=rbinom(1,1,p*exp(beta*x1[i]+0.0001*cpt))
if(test==1){t[i]=cpt;delta[i]=1}
if(cpt>censure[i] || cpt==365){t[i]=cpt ; test=1}
}
}
datum2=data.frame(x1=x1,x2=x2,delta=delta,t=t)
model<-coxph(Surv(t,delta) ~. , data = datum1)
summary(model)
model<-coxph(Surv(t,delta) ~. , data = datum2)
summary(model)
model<-coxph(Surv(t,delta) ~. , data = datum1)
summary(model)
model<-coxph(Surv(t,delta) ~. , data = datum2)
summary(model)
set.seed(2)
n=500
x1=rbinom(n,1,0.4)
x2=rbinom(n,1,0.2)
censure=floor(rexp(n,1/2000))
delta=rep(0,n)
t=rep(0,n)
p=0.001
beta=2
#Les jours sont décomptés un à un  par la boucle while et la variable cpt
#chacun étant soumis à un risque instantané.
for(i in 1:n){
test=0
cpt=0
while(test!=1){
cpt=cpt+1
test=rbinom(1,1,p*exp(beta*x1[i]/log(cpt+1)))
if(test==1){t[i]=cpt;delta[i]=1}
if(cpt>censure[i] || cpt==365){t[i]=cpt ; test=1}
}
}
datum1=data.frame(x1=x1,x2=x2,delta=delta,t=t)
set.seed(2)
n=500
x1=rbinom(n,1,0.4)
x2=rbinom(n,1,0.2)
censure=floor(rexp(n,1/2000))
delta=rep(0,n)
t=rep(0,n)
p=0.001
beta=2
#Les jours sont décomptés un à un  par la boucle while et la variable cpt
#chacun étant soumis à un risque instantané.
for(i in 1:n){
test=0
cpt=0
while(test!=1){
cpt=cpt+1
test=rbinom(1,1,p*exp(beta*x1[i]+0.0001*cpt))
if(test==1){t[i]=cpt;delta[i]=1}
if(cpt>censure[i] || cpt==365){t[i]=cpt ; test=1}
}
}
datum2=data.frame(x1=x1,x2=x2,delta=delta,t=t)
model<-coxph(Surv(t,delta) ~. , data = datum1)
summary(model)
model<-coxph(Surv(t,delta) ~. , data = datum2)
summary(model)
model<-coxph(Surv(t,delta) ~. , data = datum2)
summary(model)
model<-coxph(Surv(t,delta) ~. , data = datum2)
summary(model)
model<-coxph(Surv(t,delta) ~. , data = datum1)
summary(model)
model<-coxph(Surv(t,delta) ~. , data = datum1)
summary(model)
model<-coxph(Surv(t,delta) ~. , data = datum1)
summary(model)
model<-coxph(Surv(t,delta) ~. , data = datum2)
summary(model)
rat=1.751+0.859
1.751/rat
set.seed(4)
n=500
x1=rbinom(n,1,0.5)
x2=rbinom(n,1,0.5)
censure=floor(rexp(n,1/2000))
delta=rep(0,n)
t=rep(0,n)
p=0.002
beta=0.5
for(i in 1:n){
lambda0=p/log(i+1)
lambda=lambda0*exp(beta*x1[i]*x2[i])
T=rpois(1,lambda)
if(T<=censure[i]){
delta[i]=1
t[i]=T
} else {
delta[i]=0
t[i]=censure[i]
}
}
datum3=data.frame(x1=x1,x2=x2,delta=delta,t=t)
model<-coxph(Surv(t,delta) ~ x1*x2 , data = datum3)
summary(model)
set.seed(4)
n=500
x1=rbinom(n,1,0.5)
x2=rbinom(n,1,0.5)
censure=floor(rexp(n,1/2000))
delta=rep(0,n)
t=rep(0,n)
p=0.002
beta=0.5
for(i in 1:n){
lambda0=p/log(i+1)
lambda=lambda0*exp(beta*x1[i]*x2[i])
T=rpois(1,lambda)
if(T<=censure[i]){
delta[i]=1
t[i]=T
} else {
delta[i]=0
t[i]=censure[i]
}
}
datum3=data.frame(x1=x1,x2=x2,delta=delta,t=t)
model<-coxph(Surv(t,delta) ~ x1*x2 , data = datum3)
summary(model)
model<-coxph(Surv(t,delta)~.,data=pharmacoSmoking)
model<-coxph(Surv(t,delta)~ .,data=pharmacoSmoking)
pharmacoSmoking
summary(pharmacoSmoking)
model<-coxph(Surv(t,delta)~ ageGroup2,data=pharmacoSmoking)
model<-coxph(Surv(t,delta)~ ageGroup4,data=pharmacoSmoking)
model<-coxph(Surv(ttr,relapse)~ .,data=pharmacoSmoking)
model<-coxph(Surv(ttr,relapse)~ .,data=pharmacoSmoking)
summary(model)
step.model <- stepAIC(model,trace = FALSE)
coef(step.model)
library(MASS)
step.model <- stepAIC(model,trace = FALSE)
coef(step.model)
library(MASS)
step.model <- stepAIC(model,trace = FALSE)
coef(step.model)
model<-coxph(Surv(t,delta)~ id+grppatchOnly+employmentother,data=pharmacoSmoking)
model<-coxph(Surv(t,delta)~ id+grppatch0nly+employmentother,data=pharmacoSmoking)
model<-coxph(Surv(t,delta)~ id+ grppatchOnly +employmentother,data=pharmacoSmoking)
model<-coxph(Surv(t,delta)~ id + grppatchOnly +employmentother,data=pharmacoSmoking)
model<-coxph(Surv(ttr,relapse)~ id + grppatchOnly +employmentother,data=pharmacoSmoking)
res = cox.zph(coxph(Surv(ttr,relapse) ~ grp + age + employment, data = pharmacoSmoking))
plot(res)
print(res)
res = cox.zph(coxph(Surv(t,delta) ~ ., data = datum1))
plot(res)
print(res)
res = cox.zph(coxph(Surv(t,delta) ~ ., data = datum2))
plot(res)
print(res)
model<-coxph(Surv(ttr,relapse)~ id + grppatchOnly +employmentother,data=pharmacoSmoking)
model<-coxph(Surv(ttr,relapse)~ id +employmentother,data=pharmacoSmoking)
phar
model<-coxph(Surv(ttr,relapse)~ id+grp,data=pharmacoSmoking)
model<-coxph(Surv(ttr,relapse)~ id+grp+employment,data=pharmacoSmoking)
model<-coxph(Surv(ttr,relapse)~ id+grp+employment+levelSmoking,data=pharmacoSmoking)
model<-coxph(Surv(ttr,relapse)~ id+grp+employment+levelSmoking,data=pharmacoSmoking)
summary(model)
library(MASS)
step.model <- stepAIC(model,trace = FALSE)
coef(step.model)
model<-coxph(Surv(ttr,relapse)~ .,data=pharmacoSmoking)
summary(model)
library(MASS)
step.model <- stepAIC(model,trace = FALSE)
coef(step.model)
