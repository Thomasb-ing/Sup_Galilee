# Chunk 26
table(predicted.classes.T,data.T$Diagnosis)
cat("tx d'erreur de pour data.T",16/91,"\n")
table(predicted.classes.A,data.A$Diagnosis)
cat("tx d'erreur de pour data.T",28/212,"\n")
# Chunk 27
library(MASS)
step.model <- stepAIC(model,trace = FALSE)
coef(step.model)
# Chunk 28
probabilities.step.T <- predict(step.model, data.T, type = "response")
predicted.classes.step.T <- ifelse(probabilities.step.T > 0.5, "pos", "neg")
# Prediction accuracy
observed.classes.step.T <- data.T$Diagnosis
table(predicted.classes.step.T,data.T$Diagnosis)
n=length(data.A)
cat("R2 de Marc Fadden =", 1-model$deviance/model$null.deviance, ")\n")
cat("R2 de Cox et Snell =", 1-(model$deviance/model$null.deviance)^(2/n), ")\n")
cat("R2 de Nagelkerke =", (1-(model$deviance/model$null.deviance)^(2/n))/(1-(model$deviance)^(2/n)), ")\n")
?order
??order
?pharmacoSmoking
head(pharmacoSmoking)
sort(pharmacoSmoking$relapse)
unique(pharmacoSmoking$relapse)
order(pharmacoSmoking$survie)
order(pharmacoSmoking$ttr)
order(pharmacoSmoking$ttr)
order(pharmacoSmoking,ttr)
sort(pharmacoSmoking,ttr)
order(pharmacoSmoking,ttr)
order(pharmacoSmoking$ttr)
sort(pharmacoSmoking$ttr)
pharmacoSmoking$ttr
pharmacoSmoking$ttr< 1
sum(pharmacoSmoking$ttr< 1)
sum(pharmacoSmoking$ttr< 0)
sum(pharmacoSmoking$ttr<= 0)
estim.Kaplan.Meier<-function(data){
PROD=1
n=length(data)
Temps=sort(unique(data$ttr))
for (t in temps) {
nb_mort=sum(data$ttr<=t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(data$ttr<t)
di=nb_mort- nb_mort_avant
Y_i=sum(data$ttr>t)
PROD=PROD*(1-di/Y_i)
}
cat(PROD)
}
estim.Kaplan.Meier(pharmacoSmoking)
estim.Kaplan.Meier<-function(data){
PROD=1
n=length(data)
Temps=sort(unique(data$ttr))
for (t in Temps) {
nb_mort=sum(data$ttr<=t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(data$ttr<t)
di=nb_mort- nb_mort_avant
Y_i=sum(data$ttr>t)
PROD=PROD*(1-di/Y_i)
}
cat(PROD)
}
estim.Kaplan.Meier(pharmacoSmoking)
estim.Kaplan.Meier<-function(data){
PROD=1
n=length(data)
Temps=sort(unique(data$ttr))
for (t in Temps) {
nb_mort=sum(data$ttr <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(data$ttr < t)
di=nb_mort- nb_mort_avant
Y_i=sum(data$ttr > t)
PROD=PROD*(1-di/Y_i)
}
cat(PROD)
}
estim.Kaplan.Meier(pharmacoSmoking)
Temps=sort(unique(pharmacoSmoking$ttr))
Temps
t=0
PROD=1
nb_mort=sum(data$ttr <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(data$ttr < t)
di=nb_mort- nb_mort_avant
Y_i=sum(data$ttr > t)
PROD=PROD*(1-di/Y_i)
data$ttr
data=pharmacoSmoking
nb_mort=sum(data$ttr <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(data$ttr < t)
di=nb_mort- nb_mort_avant
Y_i=sum(data$ttr > t)
PROD=PROD*(1-di/Y_i)
PROD=1
nb_mort=sum(data$ttr <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(data$ttr < t)
di=nb_mort- nb_mort_avant
Y_i=sum(data$ttr > t)
PROD=PROD*(1-di/Y_i)
estim.Kaplan.Meier<-function(data){
PROD=1
n=length(data)
Temps=sort(unique(data$ttr))
for (t in Temps) {
nb_mort=sum(data$ttr <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(data$ttr < t)
di=nb_mort- nb_mort_avant
Y_i=n- nb_mort_avant
PROD=PROD*(1-di/Y_i)
}
cat(PROD)
}
estim.Kaplan.Meier(data)
estim.Kaplan.Meier<-function(data){
PROD=1
li=list(PROD)
n=length(data)
Temps=sort(unique(data$ttr))
for (t in Temps) {
nb_mort=sum(data$ttr <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(data$ttr < t)
di=nb_mort- nb_mort_avant
Y_i=n- nb_mort_avant
PROD=PROD*(1-di/Y_i)
li=append(li,PROD)
}
cat(li)
}
estim.Kaplan.Meier(data)
estim.Kaplan.Meier<-function(data){
PROD=1
li=list(PROD)
n=length(data)
Temps=sort(unique(data$ttr))
for (t in Temps) {
nb_mort=sum(data$ttr <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(data$ttr < t)
di=nb_mort- nb_mort_avant
Y_i=n- nb_mort_avant
PROD=PROD*(1-di/Y_i)
li=append(li,PROD)
}
print(li)
}
estim.Kaplan.Meier(data)
estim.Kaplan.Meier<-function(data){
PROD=1
li=list(PROD)
n=length(data)
Temps=sort(unique(data$ttr))
for (t in Temps) {
nb_mort=sum(data$ttr <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(data$ttr < t)
di=nb_mort- nb_mort_avant
Y_i=n-nb_mort_avant
PROD=PROD*(1-di/Y_i)
li=append(li,di)
}
print(li)
}
estim.Kaplan.Meier(data)
estim.Kaplan.Meier<-function(data){
PROD=1
li=list(PROD)
n=length(data)
Temps=sort(unique(data$ttr))
for (t in Temps) {
nb_mort=sum(data$ttr <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(data$ttr < t)
di=nb_mort- nb_mort_avant
Y_i=n-nb_mort_avant
PROD=PROD*(1-di/Y_i)
li=append(li,Y_i)
}
print(li)
}
estim.Kaplan.Meier(data)
n
t=
2
sum(data$ttr < t)
sum(data$ttr < 0)
sum(data$ttr < 1)
sum(data$ttr < 2)
sum(data$ttr <= 1)
sum(data$ttr <= 120)
sum(data$ttr <= Temps[end])
sum(data$ttr <= Temps[39])
len(data$ttr)
length(data$ttr)
length(data)
estim.Kaplan.Meier<-function(data){
PROD=1
li=list(PROD)
n=length(data$ttr)
Temps=sort(unique(data$ttr))
for (t in Temps) {
nb_mort=sum(data$ttr <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(data$ttr < t)
di=nb_mort- nb_mort_avant
Y_i=n-nb_mort_avant
PROD=PROD*(1-di/Y_i)
li=append(li,Y_i)
}
print(li)
}
estim.Kaplan.Meier(pharmacoSmoking)
estim.Kaplan.Meier<-function(data){
PROD=1
li=list(PROD)
n=length(data$ttr)
Temps=sort(unique(data$ttr))
for (t in Temps) {
nb_mort=sum(data$ttr <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(data$ttr < t)
di=nb_mort- nb_mort_avant
Y_i=n-nb_mort_avant
PROD=PROD*(1-di/Y_i)
li=append(li,PROD)
}
print(li)
}
estim.Kaplan.Meier(pharmacoSmoking)
estim.Kaplan.Meier<-function(temps,delta){
PROD=1
li=list(PROD)
n=length(temps)
Temps=sort(unique(temps))
for (t in Temps) {
nb_mort=sum(temps <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(temps < t)
di=nb_mort- nb_mort_avant
Y_i=n-nb_mort_avant
PROD=PROD*(1-di/Y_i)
li=append(li,PROD)
}
return(li)
}
estim.Kaplan.Meier(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
li=estim.Kaplan.Meier(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
temps=pharmacoSmoking$ttr
temps=sort(unique(temps))
tableau <- data.frame(x = temps, y = li)
temps
plot(li,sort(unique(pharmacoSmoking$ttr)))
pharmacoSmoking$relapse
pharmacoSmoking$ttr <0
pharmacoSmoking$ttr <2
pharmacoSmoking$ttr <2 & pharmacoSmoking$relapse == 0
temps=pharmacoSmoking$ttr
nb_mort=sum(temps <= 3) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(temps < 3)
di=nb_mort- nb_mort_avant
di
disum(temps=3)
sum(temps=3)
sum(temps==3)
sum(temps>3)
sum(temps)
length(temps)
sum(temps<3)
estim.Kaplan.Meier<-function(temps,delta){
PROD=1
li=list(PROD)
n=length(temps)
Temps=sort(unique(temps))
for (t in Temps) {
nb_mort=sum(temps <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(temps < t)
c_i=sum(temps==t & delta=0)
#di=nb_mort- nb_mort_avant
di=sum(temps==t)- c_i #gens mort au temps t
Y_i=sum(temps>t)
PROD=PROD*(1-di/Y_i)
li=append(li,PROD)
}
return(li)
}
estim.Kaplan.Meier<-function(temps,delta){
PROD=1
li=list(PROD)
n=length(temps)
Temps=sort(unique(temps))
for (t in Temps) {
nb_mort=sum(temps <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(temps < t)
c_i=sum(temps==t & delta==0)
#di=nb_mort- nb_mort_avant
di=sum(temps==t)- c_i #gens mort au temps t
Y_i=sum(temps>t)
PROD=PROD*(1-di/Y_i)
li=append(li,PROD)
}
return(li)
}
estim.Kaplan.Meier(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
estim.Kaplan.Meier<-function(temps,delta){
PROD=1
li=list(PROD)
n=length(temps)
Temps=sort(unique(temps))
for (t in Temps) {
nb_mort=sum(temps <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(temps < t)
c_i=sum(temps==t & delta==0)
#di=nb_mort- nb_mort_avant
di=sum(temps==t)- c_i #gens mort au temps t
Y_i=n- nb_mort_avant
PROD=PROD*(1-di/Y_i)
li=append(li,PROD)
}
return(li)
}
estim.Kaplan.Meier(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
S=estim.Kaplan.Meier(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
T=sort(unique(pharmacoSmoking$ttr))
plot(T,S)
T
S
length(T)
length(S)
T=append(T,0)
length(T)
plot(T,S)
estim.Kaplan.Meier<-function(temps,delta){
PROD=1
li=list()
n=length(temps)
Temps=sort(unique(temps))
for (t in Temps) {
nb_mort=sum(temps <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(temps < t)
c_i=sum(temps==t & delta==0)
#di=nb_mort- nb_mort_avant
di=sum(temps==t)- c_i #gens mort au temps t
Y_i=n- nb_mort_avant
PROD=PROD*(1-di/Y_i)
li=append(li,PROD)
}
return(li)
}
S=estim.Kaplan.Meier(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
head(gastricXelox)
#Pour pharmacoSmoking
S=estim.Kaplan.Meier(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
T=sort(unique(pharmacoSmoking$ttr))
plot(T,S)
# gastriXelox
S=estim.Kaplan.Meier(gastricXelox$timeWeeks,gastricXelox$delta)
T=sort(unique(gastricXelox$timeWeeks))
plot(T,S)
estim.Greenwood<-function(temps,delta){
PROD=1
S=list()
VarS=list()
n=length(temps)
Temps=sort(unique(temps))
sum
for (t in Temps) {
nb_mort=sum(temps <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(temps < t)
c_i=sum(temps==t & delta==0)
#di=nb_mort- nb_mort_avant
di=sum(temps==t)- c_i #gens mort au temps t
Y_i=n- nb_mort_avant
PROD=PROD*(1-di/Y_i)
sum=sum+di/(Y_i*(Y_i-di))
S=append(S,PROD)
VarS=append(VarS,sum*PROD^2)
}
return(li)
}
estim.Greenwood<-function(temps,delta){
PROD=1
S=list()
VarS=list()
n=length(temps)
Temps=sort(unique(temps))
sum
for (t in Temps) {
nb_mort=sum(temps <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(temps < t)
c_i=sum(temps==t & delta==0)
#di=nb_mort- nb_mort_avant
di=sum(temps==t)- c_i #gens mort au temps t
Y_i=n- nb_mort_avant
PROD=PROD*(1-di/Y_i)
sum=sum+di/(Y_i*(Y_i-di))
S=append(S,PROD)
VarS=append(VarS,sum*PROD^2)
}
return(list(S,VarS))
}
S,VarS=estim.Greenwood(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
estim.Greenwood(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
estim.Greenwood<-function(temps,delta){
PROD=1
S=list()
VarS=list()
n=length(temps)
Temps=sort(unique(temps))
sum=0
for (t in Temps) {
nb_mort=sum(temps <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(temps < t)
c_i=sum(temps==t & delta==0)
#di=nb_mort- nb_mort_avant
di=sum(temps==t)- c_i #gens mort au temps t
Y_i=n- nb_mort_avant
PROD=PROD*(1-di/Y_i)
sum=sum+di/(Y_i*(Y_i-di))
S=append(S,PROD)
VarS=append(VarS,sum*PROD^2)
}
return(list(S,VarS))
}
estim.Greenwood(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
tab=estim.Greenwood(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
tab
tab[0]
tab[1]
tab[2]
estim.Greenwood<-function(temps,delta){
PROD=1
S=list()
VarS=list()
n=length(temps)
Temps=sort(unique(temps))
sum=0
for (t in Temps) {
nb_mort=sum(temps <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(temps < t)
c_i=sum(temps==t & delta==0)
#di=nb_mort- nb_mort_avant
di=sum(temps==t)- c_i #gens mort au temps t
Y_i=n- nb_mort_avant
PROD=PROD*(1-di/Y_i)
sum=sum+di/(Y_i*(Y_i-di))
S=append(S,PROD)
VarS=append(VarS,sum*PROD^2)
}
return(list(S=S,VarS=VarS))
}
tab=estim.Greenwood(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
tab$S
S=tab$S
VarS=tab$VarS
tab=estim.Greenwood(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
S=tab$S
VarS=tab$VarS
plot(T,VarS)
#pharmacoSmoking
tab=estim.Greenwood(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
S=tab$S
VarS=tab$VarS
T=sort(unique(pharmacoSmoking$ttr))
plot(T,VarS)
gastriXelox
tab=estim.Greenwood(gastricXelox$timeWeeks,gastricXelox$delta)
S=tab$S
VarS=tab$VarS
T=sort(unique(gastricXelox$timeWeeks))
plot(T,Vars)
estim.Nelson.Breslow <-function(temps,delta){
SumNelson=0
SumBreslow=0
Breslow=list()
Nelson=list()
n=length(temps)
Temps=sort(unique(temps))
sum=0
for (t in Temps) {
nb_mort=sum(temps <= t) #nbr de personne qui on relapse avant t
nb_mort_avant=sum(temps < t)
c_i=sum(temps==t & delta==0)
#di=nb_mort- nb_mort_avant
di=sum(temps==t)- c_i #gens mort au temps t
Y_i=n- nb_mort_avant
SumBreslow=SumBreslow-log(1-di/Y_i)
SumNelson=SumNelson+di/Y_i
Breslow=append(Breslow,SumBreslow)
Nelson=append(Nelson,SumNelson)
}
return(list(Breslow=Breslow,Nelson=Nelson))
}
tab=estim.Nelson.Breslow(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
tab$Breslow
#pharmacoSmoking
tab=estim.Nelson.Breslow(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
T=sort(unique(pharmacoSmoking$ttr))
plot(T,tab$Nelson)+
plot(T,tab$Breslow)
#gastriXelox
tab=estim.Nelson.Breslow(gastricXelox$timeWeeks,gastricXelox$delta)
T=sort(unique(gastricXelox$timeWeeks))
plot(T,tab$Breslow)+
plot(T,tab$Neslon)
km = survfit(Surv(timeWeeks, delta) ~ 1, data = gastricXelox)
autoplot( km )
km2 = survfit(Surv(ttr, relapse) ~ 1, data = pharmacoSmoking)
autoplot( km2 )
#Pour pharmacoSmoking
S=estim.Kaplan.Meier(pharmacoSmoking$ttr,pharmacoSmoking$relapse)
T=sort(unique(pharmacoSmoking$ttr))
plot(T,S)
# gastriXelox
S=estim.Kaplan.Meier(gastricXelox$timeWeeks,gastricXelox$delta)
T=sort(unique(gastricXelox$timeWeeks))
plot(T,S)
